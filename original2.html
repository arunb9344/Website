<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TH6HEYD5YK"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-TH6HEYD5YK');
    </script>

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@graph": [
            {
                "@type": "WebPage",
                "name": "Admin Panel - EyeTech Securities",
                "url": "https://www.eyetechsecurities.in/admin.html",
                "description": "Admin panel for managing CCTV service and installation bookings at EyeTech Securities in Chennai.",
                "isPartOf": {
                    "@type": "WebSite",
                    "url": "https://www.eyetechsecurities.in/"
                },
                "publisher": {
                    "@type": "Organization",
                    "@id": "https://www.eyetechsecurities.in/#organization"
                }
            },
            {
                "@type": "Organization",
                "@id": "https://www.eyetechsecurities.in/#organization",
                "name": "EyeTech Securities",
                "url": "https://www.eyetechsecurities.in/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://www.eyetechsecurities.in/eyetech%20logo%20jpg.webp"
                },
                "description": "EyeTech Securities is an authorized Hikvision dealer and leading CCTV camera supplier in Chennai, providing expert installation and service since 2018.",
                "address": {
                    "@type": "PostalAddress",
                    "streetAddress": "No.56/80, 1st Floor, Medavakkam Main Road",
                    "addressLocality": "Chennai",
                    "addressRegion": "Tamil Nadu",
                    "postalCode": "600117",
                    "addressCountry": "IN"
                },
                "contactPoint": [
                    {
                        "@type": "ContactPoint",
                        "telephone": "+91-9962835944",
                        "contactType": "Customer Service",
                        "contactOption": "TollFree",
                        "areaServed": "IN",
                        "availableLanguage": ["English", "Tamil"]
                    },
                    {
                        "@type": "ContactPoint",
                        "url": "https://wa.me/+919962835944",
                        "contactType": "Customer Service",
                        "contactOption": "Messaging"
                    }
                ],
                "sameAs": [
                    "https://www.facebook.com/eyetechsecurities",
                    "https://www.instagram.com/eyetechsecurities"
                ]
            }
        ]
    }
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin panel for managing CCTV service and installation bookings at EyeTech Securities in Chennai.">
    <meta name="keywords" content="EyeTech Securities, CCTV service admin, CCTV installation admin, Chennai CCTV management">

    <!-- Open Graph Tags -->
    <meta property="og:title" content="Admin Panel - EyeTech Securities">
    <meta property="og:description" content="Admin panel for managing CCTV service and installation bookings at EyeTech Securities in Chennai.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.eyetechsecurities.in/admin.html">
    <meta property="og:image" content="https://www.eyetechsecurities.in/eyetech%20logo%20jpg.webp">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="EyeTech Securities">

    <!-- Twitter (X) Card Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Admin Panel - EyeTech Securities">
    <meta name="twitter:description" content="Admin panel for managing CCTV service and installation bookings at EyeTech Securities in Chennai.">
    <meta name="twitter:image" content="https://www.eyetechsecurities.in/eyetech%20logo%20jpg.webp">
    <meta name="twitter:image:alt" content="EyeTech Securities Logo">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.eyetechsecurities.in/admin.html">

    <title>Admin Panel - EyeTech Securities</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/eyetech_logo_jpg.webp">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Firebase SDK (Modular, v9.23.0) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
        import { getFirestore, collection, getDocs, query, orderBy, where, doc, updateDoc, increment, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDTHFO2c6SwjAmBueJBx4I8wNiQ3lmHRMw",
            authDomain: "eye-tech-service-booking.firebaseapp.com",
            projectId: "eye-tech-service-booking",
            storageBucket: "eye-tech-service-booking.firebasestorage.app",
            messagingSenderId: "169633761790",
            appId: "1:169633761790:web:142d3e5ef2f8c6091c58af",
            measurementId: "G-JFB3G4CECS"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            window.firebaseServices = {
                auth,
                db,
                signInWithEmailAndPassword,
                signInWithPopup,
                GoogleAuthProvider,
                createUserWithEmailAndPassword,
                signOut,
                onAuthStateChanged,
                collection,
                getDocs,
                query,
                orderBy,
                where,
                doc,
                updateDoc,
                increment,
                getDoc,
                setDoc
            };
            console.log('Firebase initialized successfully for admin panel');
        } catch (error) {
            console.error('Firebase initialization error:', error);
        }
    </script>

    <style>
    @media (max-width: 639px) {
    #mobile-menu {
        overflow: visible;
    }
    #mobile-menu a {
        padding-left: 1rem;
        padding-right: 0.75rem;
        align-items: center;
        min-width: 160px;
        display: flex;
    }
    #mobile-menu svg {
        margin-left: 0.25rem;
        width: 1.75rem;
        height: 1.75rem;
        overflow: visible;
    }
    .admin-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
        position: relative;
        z-index: 10;
        touch-action: pan-x;
    }
    .table-container {
        max-height: calc(100vh - 250px);
        overflow-y: auto;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }
    .admin-table th,
    .admin-table td {
        min-width: 80px;
        padding: 0.5rem;
        font-size: 0.75rem;
    }
    .admin-table th:nth-child(7),
    .admin-table td:nth-child(7) {
        width: 150px;
    }
    .admin-table td:nth-child(7) textarea.solution-textarea {
        min-width: 130px;
    }
    .admin-table textarea.solution-textarea {
        min-height: 50px;
        max-height: 100px;
        width: 100%;
    }
    .admin-table input.amount-input,
    .admin-table input.num-cameras-input,
    .admin-table input.price-input,
    .admin-table input.serial-number-input {
        width: 70px;
    }
    .admin-table button {
        padding: 0.5rem 0.75rem;
        font-size: 0.75rem;
    }
    .search-container {
        flex-direction: column;
        align-items: stretch;
    }
    .search-container input {
        max-width: 100%;
        margin-bottom: 0.5rem;
    }
    .tab-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        padding-bottom: 0.5rem;
        overflow-x: visible;
    }
    .main-tab {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        margin-right: 0.5rem;
        border-radius: 0.5rem;
    }
    .sub-tab {
        padding: 0.4rem 0.8rem;
        font-size: 0.75rem;
        font-weight: 600;
        border-radius: 0.5rem;
        border: 2px solid transparent;
        flex: 1;
        text-align: center;
        background-color: #e5e7eb; /* Darker default background */
    }
    .sub-tab:hover {
        background-color: #bfdbfe; /* Darker hover background */
        transform: translateY(-1px);
    }
    .sub-tab.active {
        border-color: #1e3a8a;
        background: linear-gradient(135deg, #1e3a8a, #3b82f6); /* Darker active gradient */
        color: #ffffff;
    }
    .booking-header {
        padding: 1rem;
    }
    .login-prompt {
        font-size: 0.875rem;
        padding: 0.75rem;
    }
    body.keyboard-active {
        overflow-y: auto;
        padding-bottom: 300px;
    }
}
@media (min-width: 640px) {
    .admin-table th,
    .admin-table td {
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
    }
    .admin-table th:nth-child(7),
    .admin-table td:nth-child(7) {
        width: 250px;
    }
    .admin-table td:nth-child(7) textarea.solution-textarea {
        min-width: 230px;
    }
    .admin-table textarea.solution-textarea {
        min-height: 60px;
        max-height: 150px;
        width: 100%;
    }
    .admin-table input.amount-input,
    .admin-table input.num-cameras-input,
    .admin-table input.price-input,
    .admin-table input.serial-number-input {
        width: 120px;
    }
}
.nav-active {
    background-color: #2563eb;
    transform: scale(1.05);
}
.error-message {
    color: #dc2626;
    font-size: 0.875rem;
    background: #fef2f2;
    padding: 0.5rem;
    border-radius: 0.375rem;
    margin-top: 0.25rem;
    display: none;
}
.error-message.active {
    display: block;
}
.success-message {
    color: #16a34a;
    font-size: 1rem;
    text-align: center;
    background: #ecfdf5;
    padding: 0.75rem;
    border-radius: 0.375rem;
    margin-bottom: 1rem;
    display: none;
}
.success-message.active {
    display: block;
}
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.5);
    opacity: 0;
    transition: opacity 0.3s ease;
}
.modal.active {
    display: block;
    opacity: 1;
}
.modal-content {
    background-color: #ffffff;
    margin: 5% auto;
    padding: 2rem;
    border-radius: 0.75rem;
    width: 90%;
    max-width: 350px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    transform: translateY(-50px);
    transition: transform 0.3s ease;
}
.modal.active .modal-content {
    transform: translateY(0);
}
.auth-modal-content {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}
.auth-button {
    transition: all 0.3s ease;
    border-radius: 0.5rem;
    font-weight: 500;
    background: linear-gradient(to right, #2563eb, #4f46e5);
    color: #ffffff;
    padding: 0.75rem 2rem;
    font-size: 1rem;
}
.auth-button:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}
#signin-btn {
    background: linear-gradient(135deg, #1e3a8a, #3b82f6);
    border: none;
    border-radius: 0.75rem;
    padding: 0.75rem 2rem;
    font-size: 1rem;
    font-weight: 600;
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
}
#signin-btn:hover {
    background: linear-gradient(135deg, #1e40af, #60a5fa);
    transform: translateY(-2px);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
}
#signin-btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}
.google-button {
    background-color: #ffffff;
    border: 1px solid #d1d5db;
    color: #374151;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}
.google-button:hover {
    background-color: #f3f4f6;
    transform: scale(1.05);
}
.toggle-auth {
    cursor: pointer;
    color: #2563eb;
    transition: color 0.2s ease;
}
.toggle-auth:hover {
    color: #1d4ed8;
}
.close-modal {
    position: absolute;
    top: 1rem;
    right: 1rem;
    cursor: pointer;
    color: #6b7280;
    font-size: 1.5rem;
    transition: color 0.2s ease;
}
.close-modal:hover {
    color: #374151;
}
.floating-label-group {
    position: relative;
    margin-bottom: 1.5rem;
}
.floating-label {
    position: absolute;
    top: 0.75rem;
    left: 0.75rem;
    color: #6b7280;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    pointer-events: none;
}
.floating-label-group input:not(:placeholder-shown) + .floating-label,
.floating-label-group input:focus + .floating-label {
    top: -0.75rem;
    left: 0.5rem;
    font-size: 0.75rem;
    color: #2563eb;
    background: #ffffff;
    padding: 0 0.25rem;
}
.floating-label-group input {
    border: none;
    border-bottom: 2px solid #d1d5db;
    border-radius: 0;
    padding: 0.75rem;
    width: 100%;
    font-size: 0.875rem;
}
.floating-label-group input:focus {
    outline: none;
    border-bottom: 2px solid #2563eb;
}
.main-tab {
    cursor: pointer;
    padding: 0.75rem 1.5rem;
    border-radius: 0.75rem;
    transition: all 0.3s ease;
    background-color: #e5e7eb;
    font-size: 1rem;
    font-weight: 600;
    color: #1f2937;
    margin-right: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
.main-tab:hover {
    background-color: #d1d5db;
    transform: translateY(-2px);
}
.main-tab.active {
    background: linear-gradient(135deg, #2563eb, #4f46e5);
    color: #ffffff;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    transform: translateY(-2px);
}
.sub-tab {
    cursor: pointer;
    padding: 0.5rem 1.25rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    background-color: #e5e7eb;
    font-size: 0.875rem;
    font-weight: 500;
    color: #374151;
    white-space: nowrap;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}
.sub-tab:hover {
    background-color: #bfdbfe;
    transform: translateY(-1px);
}
.sub-tab.active {
    background: linear-gradient(135deg, #1e3a8a, #3b82f6);
    color: #ffffff;
    font-weight: 600;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}
.tab-container {
    display: flex;
    gap: 0.75rem;
    margin-bottom: 1rem;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 0.25rem;
    scrollbar-width: thin;
    scrollbar-color: #2563eb #e5e7eb;
}
.tab-container::-webkit-scrollbar {
    height: 6px;
}
.tab-container::-webkit-scrollbar-track {
    background: #e5e7eb;
}
.tab-container::-webkit-scrollbar-thumb {
    background: #2563eb;
    border-radius: 3px;
}
.table-container {
    background: #ffffff;
    border-radius: 0.5rem;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    border: 1px solid transparent;
    border-image: linear-gradient(to right, #2563eb, #4f46e5) 1;
}
.admin-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
}
.admin-table th,
.admin-table td {
    padding: 0.75rem 1rem;
    text-align: left;
    border-bottom: 1px solid #e5e7eb;
}
.admin-table th {
    background: linear-gradient(to right, #2563eb, #4f46e5);
    color: #ffffff;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.875rem;
}
.admin-table tr:last-child td {
    border-bottom: none;
}
.admin-table tr:hover {
    background: #f9fafb;
}
.admin-table td {
    font-size: 0.875rem;
    color: #374151;
}
.admin-table select,
.admin-table textarea,
.admin-table input[type="number"],
.admin-table input[type="text"] {
    transition: all 0.3s ease;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    padding: 0.75rem;
}
.admin-table textarea.solution-textarea {
    min-height: 60px;
    resize: vertical;
    width: 100%;
    box-sizing: border-box;
    overflow-y: auto;
    max-height: 150px;
}
.admin-table input.amount-input,
.admin-table input.num-cameras-input,
.admin-table input.price-input,
.admin-table input.serial-number-input {
    width: 120px;
}
.admin-table select.status-select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 1.25rem;
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>');
    padding-right: 2rem;
}
.admin-table select.status-select:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}
.admin-table select.status-select option[value="Pending"] {
    background-color: #fefcbf;
    color: #000;
}
.admin-table select.status-select option[value="Completed"] {
    background-color: #c6f6d5;
    color: #000;
}
.admin-table select.status-select option[value="Cancelled"] {
    background-color: #fed7d7;
    color: #000;
}
.admin-table select.status-select:has(option[value="Pending"]:checked) {
    background-color: #fefcbf;
    color: #000;
    border-color: #f59e0b;
}
.admin-table select.status-select:has(option[value="Completed"]:checked) {
    background-color: #c6f6d5;
    color: #000;
    border-color: #16a34a;
}
.admin-table select.status-select:has(option[value="Cancelled"]:checked) {
    background-color: #fed7d7;
    color: #000;
    border-color: #dc2626;
}
.admin-table select.status-select:hover,
.admin-table textarea.solution-textarea:hover,
.admin-table input.amount-input:hover,
.admin-table input.num-cameras-input:hover,
.admin-table input.price-input:hover,
.admin-table input.serial-number-input:hover {
    transform: scale(1.02);
}
.admin-table button {
    background: linear-gradient(to right, #2563eb, #4f46e5);
    color: #ffffff;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: all 0.3s ease;
}
.admin-table button:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}
.admin-table button:disabled {
    background: #9ca3af;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
}
.search-container {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
}
.search-container input {
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    width: 100%;
    max-width: 300px;
    font-size: 0.875rem;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
}
.search-container input:focus {
    outline: none;
    border-color: #2563eb;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}
.search-container input:hover {
    transform: scale(1.02);
}
.search-container button {
    background: linear-gradient(to right, #2563eb, #4f46e5);
    color: #ffffff;
    padding: 0.75rem 1.5rem;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    transition: all 0.3s ease;
}
.search-container button:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}
.booking-header {
    background: linear-gradient(to right, #1e3a8a, #3b82f6);
    color: #ffffff;
    padding: 2rem;
    border-radius: 0.75rem;
    text-align: center;
    margin-bottom: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.login-prompt {
    font-size: 1.125rem;
    font-weight: 600;
    color: #dc2626;
    background: #fef2f2;
    padding: 1rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border: 1px solid transparent;
    border-image: linear-gradient(to right, #dc2626, #f87171) 1;
    text-align: center;
    margin-bottom: 1rem;
}
.centered-auth-button {
    text-align: center;
    max-width: 200px;
    margin: 0 auto;
}
</style>
</head>
<body class="font-sans">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-gray-600 to-gray-600 text-white p-4 sticky top-0 z-20 shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <img src="eyetech logo png.webp" alt="Eye Tech Securities Logo" class="w-8 h-8 md:w-10 md:h-10 object-contain">
                <h1 class="text-xl md:text-2xl font-bold">Eye Tech Securities</h1>
            </div>
            <div class="hidden md:flex space-x-4">
                <a href="/index.html" class="flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-blue-600 hover:scale-105 transition transform">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    <span>Home</span>
                </a>
                <a href="/packages.html" class="flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-blue-600 hover:scale-105 transition transform">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0v6l-8 4m0-10L4 13m8 4v6m-8-6l8 4 8-4"></path></svg>
                    <span>Packages</span>
                </a>
                <a href="/Blog/blog.html" class="flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-blue-600 hover:scale-105 transition transform">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 22" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                    <span>Blog</span>
                </a>
                <a href="/about.html" class="flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-blue-600 hover:scale-105 transition transform">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <span>About Us</span>
                </a>
                <a href="/contact.html" class="flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-blue-600 hover:scale-105 transition transform">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <span>Contact</span>
                </a>
                <a href="/calculator.html" class="flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-blue-600 hover:scale-105 transition transform">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m-3 3v6m-3-3h6m-9 6h12a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <span>Storage Calculator</span>
                </a>
                <a href="/servicebooking.html" class="flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-blue-600 hover:scale-105 transition transform">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    <span>Service Booking</span>
                </a>
                <a href="/admin.html" class="flex items-center space-x-1 px-3 py-2 rounded-md nav-active">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    <span>Admin Panel</span>
                </a>
            </div>
            <!-- Mobile Menu Toggle -->
            <button class="md:hidden focus:outline-none" onclick="toggleMenu()" aria-label="Toggle mobile menu">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-gray-600 text-white p-4">
            <a href="/index.html" class="flex items-center space-x-2 py-2 hover:bg-blue-600 rounded-md px-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                <span>Home</span>
            </a>
            <a href="/packages.html" class="flex items-center space-x-2 py-2 hover:bg-blue-600 rounded-md px-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0v6l-8 4m0-10L4 13m8 4v6m-8-6l8 4 8-4"></path></svg>
                <span>Packages</span>
            </a>
            <a href="/Blog/blog.html" class="flex items-center space-x-2 py-2 hover:bg-blue-600 rounded-md px-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path></svg>
                <span>Blog</span>
            </a>
            <a href="/about.html" class="flex items-center space-x-2 py-2 hover:bg-blue-600 rounded-md px-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span>About Us</span>
            </a>
            <a href="/contact.html" class="flex items-center space-x-2 py-2 hover:bg-blue-600 rounded-md px-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                <span>Contact</span>
            </a>
            <a href="/calculator.html" class="flex items-center space-x-2 py-2 hover:bg-blue-600 rounded-md px-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m-3 3v6m-3-3h6m-9 6h12a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                <span>Storage Calculator</span>
            </a>
            <a href="/servicebooking.html" class="flex items-center space-x-2 py-2 hover:bg-blue-600 rounded-md px-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                <span>Service Booking</span>
            </a>
            <a href="/admin.html" class="flex items-center space-x-2 py-2 bg-blue-600 rounded-md px-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                <span>Admin Panel</span>
            </a>
        </div>
    </nav>

    <!-- Authentication Section -->
    <section id="auth-section" class="py-4">
        <div class="container mx-auto px-4 text-right">
            <div id="auth-status" class="inline-flex items-center space-x-2">
                <span id="user-email" class="text-gray-700"></span>
                <button id="signout-btn" class="bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded auth-button hidden">Sign Out</button>
            </div>
        </div>
    </section>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content auth-modal-content relative">
            <i class="fas fa-times-circle close-modal" onclick="closeAuthModal()"></i>
            <div id="signin-form" class="hidden">
                <h2 class="text-2xl font-bold text-center mb-6">Sign In</h2>
                <div class="floating-label-group">
                    <input type="email" id="signin-email" class="mt-1 w-full" required placeholder=" ">
                    <label class="floating-label">Email</label>
                    <p id="signin-email-error" class="error-message">Please enter a valid email.</p>
                </div>
                <div class="floating-label-group">
                    <input type="password" id="signin-password" class="mt-1 w-full" required placeholder=" ">
                    <label class="floating-label">Password</label>
                    <p id="signin-password-error" class="error-message">Please enter your password.</p>
                </div>
                <button type="button" id="signin-btn" class="py-2 px-4 w-full mb-2">Sign In</button>
                <button type="button" id="google-signin-btn" class="google-button py-2 px-4 w-full mb-2">
                    <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.20-2.25H12v4.51h5.84c-.25 1.34-.98 2.47-2.07 3.23v2.68h3.34c1.95-1.80 3.07-4.45 3.07-7.17z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-1.01 7.28-2.73l-3.34-2.68c-1.01.68-2.30 1.08-3.94 1.08-3.02 0-5.58-2.04-6.50-4.78l-3.28 2.53C4.54 20.99 7.97 23 12 23z"/><path fill="#FBBC05" d="M5.50 14.25c-.23-.67-.36-1.39-.36-2.14s.13-1.47.36-2.14l-3.28-2.53C.99 8.76.50 10.38.50 12s.49 3.24 1.72 4.56l3.28-2.53z"/><path fill="#EA4335" d="M12 4.75c1.64 0 3.11.55 4.27 1.62l3.20-3.20C17.46 1.01 14.97 0 12 0 7.97 0 4.54 2.01 2.72 4.73l3.28 2.53c.92-2.74 3.48-4.76 6.50-4.76z"/></svg>
                    Sign In with Google
                </button>
                <p class="text-center text-sm">Don't have an account? <span class="toggle-auth" onclick="toggleAuthForm('signup')">Sign Up</span></p>
                <p id="signin-result" class="text-center mt-4"></p>
            </div>
            <div id="signup-form" class="hidden">
                <h2 class="text-2xl font-bold text-center mb-6">Sign Up</h2>
                <div class="floating-label-group">
                    <input type="email" id="signup-email" class="mt-1 w-full" required placeholder=" ">
                    <label class="floating-label">Email</label>
                    <p id="signup-email-error" class="error-message">Please enter a valid email.</p>
                </div>
                <div class="floating-label-group">
                    <input type="password" id="signup-password" class="mt-1 w-full" required placeholder=" ">
                    <label class="floating-label">Password</label>
                    <p id="signup-password-error" class="error-message">Please enter a password (min 6 characters).</p>
                </div>
                <button type="button" id="signup-btn" class="auth-button py-2 px-4 w-full mb-2">Sign Up</button>
                <p class="text-center text-sm">Already have an account? <span class="toggle-auth" onclick="toggleAuthForm('signin')">Sign In</span></p>
                <p id="signup-result" class="text-center mt-4"></p>
            </div>
        </div>
    </div>

    <!-- Admin Section -->
    <section id="admin-section" class="py-12 md:py-16 bg-gray-100">
    <div class="container mx-auto px-4">
        <div class="booking-header">
            <h2 class="text-2xl md:text-3xl font-bold">Admin Panel - Booking Management</h2>
            <p class="mt-2 text-sm md:text-base">Manage CCTV service and installation bookings for EyeTech Securities</p>
        </div>
        <p id="login-prompt" class="login-prompt hidden">Please sign in as admin to access the panel.</p>
        <div class="centered-auth-button">
            <button id="auth-btn" class="auth-button hidden" onclick="openAuthModal('signin')">Sign In</button>
        </div>
        <p id="error-message" class="error-message text-center mb-4"></p>
        <p id="success-message" class="success-message text-center mb-4"></p>
        <div id="admin-content" class="hidden">
            <div class="flex mb-6">
                <div class="main-tab active" data-main-tab="service">Service Bookings</div>
                <div class="main-tab" data-main-tab="installation">Installation Bookings</div>
            </div>
            <div id="service-content" class="tab-content">
                <div class="search-container">
                    <input type="text" id="phone-search-service" placeholder="Search by phone number" class="focus:ring-2 focus:ring-blue-500">
                    <button id="search-btn-service" class="flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        Search
                    </button>
                </div>
                <div class="tab-container">
                    <div class="sub-tab active" data-tab="pending">Pending</div>
                    <div class="sub-tab" data-tab="cancelled">Cancelled</div>
                    <div class="sub-tab" data-tab="completed">Completed</div>
                    <div class="sub-tab" data-tab="all">All Bookings</div>
                </div>
                <div class="table-container">
                    <table id="service-table" class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Issue</th>
                                <th>Customer Type</th>
                                <th>Comments</th>
                                <th>Solution</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div id="installation-content" class="tab-content hidden">
                <div class="search-container">
                    <input type="text" id="phone-search-installation" placeholder="Search by phone number" class="focus:ring-2 focus:ring-blue-500">
                    <button id="search-btn-installation" class="flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        Search
                    </button>
                </div>
                <div class="tab-container">
                    <div class="sub-tab active" data-tab="pending">Pending</div>
                    <div class="sub-tab" data-tab="cancelled">Cancelled</div>
                    <div class="sub-tab" data-tab="completed">Completed</div>
                    <div class="sub-tab" data-tab="all">All Bookings</div>
                </div>
                <div class="table-container">
                    <table id="installation-table" class="admin-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Name</th>
                                <th>Phone</th>
                                <th>Address</th>
                                <th>Number of Cameras</th>
                                <th>Price</th>
                                <th>DVR/NVR Serial Number</th>
                                <th>Passwords</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm md:text-base">Â© 2025 Eye Tech Securities. All rights reserved.</p>
            <p class="text-sm md:text-base mt-2">
                <a href="/Blog/privacy-policy.html" class="hover:underline">Privacy Policy</a> |
                <a href="/Blog/terms-of-service.html" class="hover:underline">Terms of Service</a>
            </p>
        </div>
    </footer>

    <script>
document.addEventListener('DOMContentLoaded', () => {
console.log('DOM fully loaded');

// Detect keypad opening on mobile and ensure table is scrollable
function handleKeyboardVisibility() {
    const inputs = document.querySelectorAll('.admin-table input, .admin-table textarea');
    inputs.forEach(input => {
        input.addEventListener('focus', () => {
            document.body.classList.add('keyboard-active');
            // Scroll table into view
            const tableContainer = input.closest('.table-container');
            if (tableContainer) {
                tableContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                // Ensure horizontal scrolling is possible
                tableContainer.style.overflowX = 'auto';
            }
            console.log('Keypad opened, body class added, table scrolled into view');
        });
        input.addEventListener('blur', () => {
            document.body.classList.remove('keyboard-active');
            const tableContainer = input.closest('.table-container');
            if (tableContainer) {
                tableContainer.style.overflowX = 'auto'; // Maintain horizontal scrolling
            }
            console.log('Keypad closed, body class removed');
        });
    });
}
handleKeyboardVisibility();

// Mobile menu toggle
window.toggleMenu = function() {
    const menu = document.getElementById('mobile-menu');
    if (menu) {
        menu.classList.toggle('hidden');
        console.log('Mobile menu toggled:', menu.classList.contains('hidden') ? 'Hidden' : 'Visible');
    } else {
        console.error('Mobile menu not found');
    }
};

// Auth Modal Functions
window.openAuthModal = function(mode = 'signin') {
    const signinForm = document.getElementById('signin-form');
    const signupForm = document.getElementById('signup-form');
    const authModal = document.getElementById('auth-modal');
    signinForm.classList.toggle('hidden', mode !== 'signin');
    signupForm.classList.toggle('hidden', mode !== 'signup');
    authModal.classList.add('active');
    document.getElementById('signin-result').textContent = '';
    document.getElementById('signup-result').textContent = '';
    document.querySelectorAll('.error-message').forEach(el => el.classList.remove('active'));
    console.log('Auth modal opened in', mode, 'mode');
};

window.closeAuthModal = function() {
    const authModal = document.getElementById('auth-modal');
    authModal.classList.remove('active');
    document.getElementById('signin-email').value = '';
    document.getElementById('signin-password').value = '';
    document.getElementById('signup-email').value = '';
    document.getElementById('signup-password').value = '';
    console.log('Auth modal closed');
};

window.toggleAuthForm = function(mode) {
    const signinForm = document.getElementById('signin-form');
    const signupForm = document.getElementById('signup-form');
    signinForm.classList.toggle('hidden', mode !== 'signin');
    signupForm.classList.toggle('hidden', mode !== 'signup');
    document.getElementById('signin-result').textContent = '';
    document.getElementById('signup-result').textContent = '';
    document.querySelectorAll('.error-message').forEach(el => el.classList.remove('active'));
    console.log('Toggled to', mode, 'form');
};

// Elements
const authBtn = document.getElementById('auth-btn');
const signoutBtn = document.getElementById('signout-btn');
const userEmail = document.getElementById('user-email');
const adminContent = document.getElementById('admin-content');
const errorMessage = document.getElementById('error-message');
const successMessage = document.getElementById('success-message');
const serviceTable = document.getElementById('service-table').querySelector('tbody');
const installationTable = document.getElementById('installation-table').querySelector('tbody');
const phoneSearchService = document.getElementById('phone-search-service');
const searchBtnService = document.getElementById('search-btn-service');
const phoneSearchInstallation = document.getElementById('phone-search-installation');
const searchBtnInstallation = document.getElementById('search-btn-installation');
const mainTabs = document.querySelectorAll('.main-tab');
const subTabsService = document.querySelectorAll('#service-content .sub-tab');
const subTabsInstallation = document.querySelectorAll('#installation-content .sub-tab');
const signinBtn = document.getElementById('signin-btn');
const googleSigninBtn = document.getElementById('google-signin-btn');
const signupBtn = document.getElementById('signup-btn');
const signinEmail = document.getElementById('signin-email');
const signinPassword = document.getElementById('signin-password');
const signupEmail = document.getElementById('signup-email');
const signupPassword = document.getElementById('signup-password');
const signinResult = document.getElementById('signin-result');
const signupResult = document.getElementById('signup-result');
const loginPrompt = document.getElementById('login-prompt');

// Verify elements
const requiredElements = [
    { id: 'auth-btn', element: authBtn },
    { id: 'signout-btn', element: signoutBtn },
    { id: 'user-email', element: userEmail },
    { id: 'admin-content', element: adminContent },
    { id: 'error-message', element: errorMessage },
    { id: 'success-message', element: successMessage },
    { id: 'service-table', element: serviceTable },
    { id: 'installation-table', element: installationTable },
    { id: 'phone-search-service', element: phoneSearchService },
    { id: 'search-btn-service', element: searchBtnService },
    { id: 'phone-search-installation', element: phoneSearchInstallation },
    { id: 'search-btn-installation', element: searchBtnInstallation },
    { id: 'signin-btn', element: signinBtn },
    { id: 'google-signin-btn', element: googleSigninBtn },
    { id: 'signup-btn', element: signupBtn },
    { id: 'login-prompt', element: loginPrompt }
];

const missingElements = requiredElements.filter(item => !item.element);
if (missingElements.length > 0) {
    console.error('Missing DOM elements:', missingElements.map(item => item.id));
    errorMessage.textContent = 'Error: Page elements missing. Please reload.';
    errorMessage.classList.add('active');
    return;
}

// Firebase Services
const { auth, db, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signOut, onAuthStateChanged, collection, getDocs, query, orderBy, where, doc, updateDoc, increment, getDoc, setDoc } = window.firebaseServices || {};

if (!auth || !db) {
    console.error('Firebase services not initialized');
    errorMessage.textContent = 'Error: Firebase not initialized. Please try again later.';
    errorMessage.classList.add('active');
    return;
}

// Admin UIDs
const ADMIN_UIDS = ['DbA2QGMEIZOovdBhIy001ZGHiIs1', 'nxUm95BAJiVhbU75pZFoKNVYt3o1', 'XuTILJTW6xf0fmSXXjQtRAD5xdH3'];

// Store bookings and current state
let serviceBookings = [];
let installationBookings = [];
let currentMainTab = localStorage.getItem('currentMainTab') || 'service';
let currentSubTabService = localStorage.getItem('currentSubTabService') || 'pending';
let currentSubTabInstallation = localStorage.getItem('currentSubTabInstallation') || 'pending';
let currentSearchService = '';
let currentSearchInstallation = '';

// Initialize tab state on page load
function initializeTabs() {
    mainTabs.forEach(tab => {
        tab.classList.toggle('active', tab.getAttribute('data-main-tab') === currentMainTab);
    });
    document.getElementById('service-content').classList.toggle('hidden', currentMainTab !== 'service');
    document.getElementById('installation-content').classList.toggle('hidden', currentMainTab !== 'installation');
    
    if (currentMainTab === 'service') {
        subTabsService.forEach(tab => {
            tab.classList.toggle('active', tab.getAttribute('data-tab') === currentSubTabService);
        });
    } else {
        subTabsInstallation.forEach(tab => {
            tab.classList.toggle('active', tab.getAttribute('data-tab') === currentSubTabInstallation);
        });
    }
}
initializeTabs();

// Debounce function
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Custom Confirm Modal for Invoice Sending
function createCustomConfirmModal(message) {
    return new Promise((resolve) => {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <div class="modal-content auth-modal-content relative">
                <i class="fas fa-times-circle close-modal" onclick="this.closest('.modal').remove()"></i>
                <h2 class="text-xl font-bold text-center mb-4">Invoice Confirmation</h2>
                <p class="text-center mb-6">${message}</p>
                <div class="flex justify-center gap-4">
                    <button id="send-invoice-btn" class="auth-button py-2 px-4">Send Invoice</button>
                    <button id="skip-sending-btn" class="py-2 px-4 rounded bg-gray-300 hover:bg-gray-400 text-gray-800">Skip Sending</button>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        modal.classList.add('active');

        const sendButton = modal.querySelector('#send-invoice-btn');
        const skipButton = modal.querySelector('#skip-sending-btn');
        const closeButton = modal.querySelector('.close-modal');

        sendButton.addEventListener('click', () => {
            modal.remove();
            resolve(true);
        });

        skipButton.addEventListener('click', () => {
            modal.remove();
            resolve(false);
        });

        closeButton.addEventListener('click', () => {
            modal.remove();
            resolve(false);
        });
    });
}

// Generate Invoice Number
async function generateInvoiceNumber() {
    const counterRef = doc(db, 'counters', 'invoice');
    try {
        const counterDoc = await getDoc(counterRef);
        let currentCount;
        if (!counterDoc.exists()) {
            currentCount = 149;
            await setDoc(counterRef, { count: currentCount });
        } else {
            currentCount = counterDoc.data().count || 149;
        }
        currentCount += 1;
        const invoiceNumber = `INV-${currentCount.toString().padStart(6, '0')}`;
        await setDoc(counterRef, { count: currentCount }, { merge: true });
        console.log('Generated invoice number:', invoiceNumber);
        return invoiceNumber;
    } catch (error) {
        console.error('Error generating invoice number:', error.code, error.message);
        errorMessage.textContent = `Error generating invoice number: ${error.message}`;
        errorMessage.classList.add('active');
        throw error;
    }
}

// Send Service Invoice Email
async function sendServiceInvoiceEmail(booking) {
    console.log('Attempting to send service invoice email for booking:', booking);
    if (!booking.email) {
        console.warn('No email provided for booking:', booking.id);
        errorMessage.textContent = 'Cannot send invoice: No email provided.';
        errorMessage.classList.add('active');
        return false;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(booking.email)) {
        console.warn('Invalid email format for booking:', booking.id, 'Email:', booking.email);
        errorMessage.textContent = 'Cannot send invoice: Invalid email format.';
        errorMessage.classList.add('active');
        return false;
    }

    try {
        const token = await auth.currentUser.getIdToken();
        const response = await fetch('/api/send-invoice', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                toEmail: booking.email,
                customerName: booking.name || 'Customer',
                invoiceNumber: booking.invoiceNumber || 'N/A',
                invoiceDate: new Date().toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).split('/').join('/'),
                amount: booking.amount || 0,
                issue: booking.issue || 'N/A',
                solution: booking.solution || 'N/A',
                address: booking.address || 'N/A',
                customerType: booking.customerType || 'N/A',
                comments: booking.comments || 'N/A'
            })
        });

        const result = await response.json();
        console.log('Service API response:', response.status, result);

        if (!response.ok) {
            throw new Error(result.error || 'Failed to send service invoice email');
        }

        console.log('Service email sent successfully to:', booking.email);
        successMessage.textContent = `Service invoice sent to ${booking.email}!`;
        successMessage.classList.add('active');
        errorMessage.classList.remove('active');

        setTimeout(() => {
            successMessage.classList.remove('active');
        }, 3000);

        return true;
    } catch (error) {
        console.error('Service email sending error:', error);
        errorMessage.textContent = `Failed to send service invoice email: ${error.message}`;
        errorMessage.classList.add('active');
        successMessage.classList.remove('active');
        return false;
    }
}

// Send Installation Invoice Email
async function sendInstallationInvoiceEmail(booking) {
    console.log('Attempting to send installation invoice email for booking:', booking);
    if (!booking.email) {
        console.warn('No email provided for booking:', booking.id);
        errorMessage.textContent = 'Cannot send installation invoice: No email provided.';
        errorMessage.classList.add('active');
        return false;
    }

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(booking.email)) {
        console.warn('Invalid email format for booking:', booking.id, 'Email:', booking.email);
        errorMessage.textContent = 'Cannot send installation invoice: Invalid email format.';
        errorMessage.classList.add('active');
        return false;
    }

    try {
        const token = await auth.currentUser.getIdToken();
        const response = await fetch('/api/send-installation-invoice', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({
                toEmail: booking.email,
                customerName: booking.name || 'Customer',
                invoiceNumber: booking.invoiceNumber || 'N/A',
                invoiceDate: new Date().toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' }).split('/').join('/'),
                numCameras: booking.numCameras || 0,
                price: booking.price || 0,
                serialNumber: booking.serialNumber || 'N/A',
                passwords: booking.passwords || 'N/A',
                address: booking.address || 'N/A',
                installationType: booking.installationType || 'N/A',
                preferredDate: booking.preferredDate || 'N/A',
                comments: booking.comments || 'N/A',
                phone: booking.phone || 'N/A'
            })
        });

        const result = await response.json();
        console.log('Installation API response:', response.status, result);

        if (!response.ok) {
            throw new Error(result.error || 'Failed to send installation invoice email');
        }

        console.log('Installation email sent successfully to:', booking.email);
        successMessage.textContent = `Installation invoice sent to ${booking.email}!`;
        successMessage.classList.add('active');
        errorMessage.classList.remove('active');

        setTimeout(() => {
            successMessage.classList.remove('active');
        }, 3000);

        return true;
    } catch (error) {
        console.error('Installation email sending error:', error);
        errorMessage.textContent = `Failed to send installation invoice email: ${error.message}`;
        errorMessage.classList.add('active');
        successMessage.classList.remove('active');
        return false;
    }
}

// Authentication State
onAuthStateChanged(auth, user => {
    console.log('Auth state changed:', user ? `User signed in: ${user.email}, UID: ${user.uid}` : 'No user signed in');
    if (user && ADMIN_UIDS.includes(user.uid)) {
        console.log('Admin signed in:', user.email, 'UID:', user.uid);
        authBtn.classList.add('hidden');
        signoutBtn.classList.remove('hidden');
        userEmail.textContent = user.email;
        adminContent.classList.remove('hidden');
        loginPrompt.classList.add('hidden');
        errorMessage.classList.remove('active');
        if (currentMainTab === 'service') {
            loadServiceBookings();
        } else {
            loadInstallationBookings();
        }
    } else if (user) {
        console.log('Non-admin user signed in:', user.email, 'UID:', user.uid);
        authBtn.classList.add('hidden');
        signoutBtn.classList.remove('hidden');
        userEmail.textContent = user.email;
        adminContent.classList.add('hidden');
        loginPrompt.classList.remove('hidden');
        errorMessage.textContent = 'Unauthorized access. Admin privileges required.';
        errorMessage.classList.add('active');
        serviceTable.innerHTML = '';
        installationTable.innerHTML = '';
    } else {
        console.log('No user signed in');
        authBtn.classList.remove('hidden');
        signoutBtn.classList.add('hidden');
        userEmail.textContent = '';
        adminContent.classList.add('hidden');
        loginPrompt.classList.remove('hidden');
        errorMessage.textContent = 'Please sign in as admin to access the panel.';
        errorMessage.classList.add('active');
        serviceTable.innerHTML = '';
        installationTable.innerHTML = '';
    }
});

// Open Sign-In Modal
authBtn.addEventListener('click', () => openAuthModal('signin'));

// Sign In
signinBtn.addEventListener('click', () => {
    const email = signinEmail.value.trim();
    const password = signinPassword.value.trim();
    signinResult.textContent = '';
    document.querySelectorAll('.error-message').forEach(el => el.classList.remove('active'));

    if (!email) {
        document.getElementById('signin-email-error').classList.add('active');
        return;
    }
    if (!password) {
        document.getElementById('signin-password-error').classList.add('active');
        return;
    }

    signInWithEmailAndPassword(auth, email, password)
        .then(() => {
            signinResult.textContent = 'Signed in successfully!';
            signinResult.style.color = '#16a34a';
            closeAuthModal();
        })
        .catch(error => {
            console.error('Sign-in error:', error.code, error.message);
            signinResult.textContent = error.message;
            signinResult.style.color = '#dc2626';
        });
});

// Google Sign In
googleSigninBtn.addEventListener('click', () => {
    const provider = new GoogleAuthProvider();
    signInWithPopup(auth, provider)
        .then(() => {
            signinResult.textContent = 'Signed in with Google successfully!';
            signinResult.style.color = '#16a34a';
            closeAuthModal();
        })
        .catch(error => {
            console.error('Google Sign-in error:', error.code, error.message);
            signinResult.textContent = error.message;
            signinResult.style.color = '#dc2626';
        });
});

// Sign Up
signupBtn.addEventListener('click', () => {
    const email = signupEmail.value.trim();
    const password = signupPassword.value.trim();
    signupResult.textContent = '';
    document.querySelectorAll('.error-message').forEach(el => el.classList.remove('active'));

    if (!email) {
        document.getElementById('signup-email-error').classList.add('active');
        return;
    }
    if (!password || password.length < 6) {
        document.getElementById('signup-password-error').classList.add('active');
        return;
    }

    createUserWithEmailAndPassword(auth, email, password)
        .then(() => {
            signupResult.textContent = 'Account created successfully!';
            signupResult.style.color = '#16a34a';
            closeAuthModal();
        })
        .catch(error => {
            console.error('Sign-up error:', error.code, error.message);
            signupResult.textContent = error.message;
            signupResult.style.color = '#dc2626';
        });
});

// Sign Out
signoutBtn.addEventListener('click', () => {
    signOut(auth)
        .then(() => {
            console.log('Admin signed out');
        })
        .catch(error => {
            console.error('Sign-out error:', error.code, error.message);
            errorMessage.textContent = `Error signing out: ${error.message}`;
            errorMessage.classList.add('active');
        });
});

// Load Service Bookings
async function loadServiceBookings() {
    console.log('Loading service bookings for tab:', currentSubTabService);
    try {
        let q;
        if (currentSubTabService === 'all') {
            q = query(collection(db, 'bookings'), orderBy('timestamp', 'desc'));
        } else {
            q = query(collection(db, 'bookings'), where('status', '==', currentSubTabService.charAt(0).toUpperCase() + currentSubTabService.slice(1)), orderBy('timestamp', 'desc'));
        }
        const querySnapshot = await getDocs(q);
        console.log('Service Firestore query returned', querySnapshot.size, 'documents');
        serviceBookings = [];
        querySnapshot.forEach(doc => {
            serviceBookings.push({ id: doc.id, ...doc.data() });
        });
        renderServiceBookings();
    } catch (error) {
        console.error('Service Firestore query error:', error.code, error.message);
        serviceTable.innerHTML = `<tr><td colspan="10" class="text-center text-red-600">Error loading service bookings: ${error.message}</td></tr>`;
        errorMessage.textContent = `Error loading service bookings: ${error.message}`;
        errorMessage.classList.add('active');
    }
}

// Load Installation Bookings
async function loadInstallationBookings() {
    console.log('Loading installation bookings for tab:', currentSubTabInstallation);
    try {
        let q;
        if (currentSubTabInstallation === 'all') {
            q = query(collection(db, 'installations'), orderBy('timestamp', 'desc'));
        } else {
            q = query(collection(db, 'installations'), where('status', '==', currentSubTabInstallation.charAt(0).toUpperCase() + currentSubTabInstallation.slice(1)), orderBy('timestamp', 'desc'));
        }
        const querySnapshot = await getDocs(q);
        console.log('Installation Firestore query returned', querySnapshot.size, 'documents');
        installationBookings = [];
        querySnapshot.forEach(doc => {
            installationBookings.push({ id: doc.id, ...doc.data() });
        });
        renderInstallationBookings();
    } catch (error) {
        console.error('Installation Firestore query error:', error.code, error.message);
        installationTable.innerHTML = `<tr><td colspan="10" class="text-center text-red-600">Error loading installation bookings: ${error.message}</td></tr>`;
        errorMessage.textContent = `Error loading installation bookings: ${error.message}`;
        errorMessage.classList.add('active');
    }
}

// Render Service Bookings
function renderServiceBookings() {
    console.log('Rendering service bookings:', serviceBookings.length);
    let filteredBookings = serviceBookings;
    if (currentSearchService) {
        filteredBookings = serviceBookings.filter(booking =>
            booking.phone.includes(currentSearchService.replace(/\D/g, ''))
        );
    }
    serviceTable.innerHTML = '';
    if (filteredBookings.length === 0) {
        serviceTable.innerHTML = `<tr><td colspan="10" class="text-center">No service bookings found.</td></tr>`;
        return;
    }
    filteredBookings.forEach(booking => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${new Date(booking.timestamp.toDate()).toLocaleDateString('en-GB')}</td>
            <td>${booking.name || 'N/A'}</td>
            <td>${booking.phone || 'N/A'}</td>
            <td>${booking.issue || 'N/A'}</td>
            <td>${booking.customerType || 'N/A'}</td>
            <td>${booking.comments || 'N/A'}</td>
            <td><textarea class="solution-textarea" data-id="${booking.id}" placeholder="Enter Solution">${booking.solution || ''}</textarea></td>
            <td><input type="number" class="amount-input" data-id="${booking.id}" value="${booking.amount || ''}" min="0" placeholder="Enter Amount"></td>
            <td>
                <select class="status-select" data-id="${booking.id}">
                    <option value="Pending" ${booking.status === 'Pending' ? 'selected' : ''}>Pending</option>
                    <option value="Completed" ${booking.status === 'Completed' ? 'selected' : ''}>Completed</option>
                    <option value="Cancelled" ${booking.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
            </td>
            <td><button class="save-btn" data-id="${booking.id}">Save</button></td>
        `;
        serviceTable.appendChild(row);
    });

    // Attach event listeners to save buttons
    document.querySelectorAll('.save-btn').forEach(button => {
        button.addEventListener('click', async () => {
            const bookingId = button.getAttribute('data-id');
            await updateServiceBooking(bookingId);
        });
    });
}

// Render Installation Bookings
function renderInstallationBookings() {
    console.log('Rendering installation bookings:', installationBookings.length);
    let filteredBookings = installationBookings;
    if (currentSearchInstallation) {
        filteredBookings = installationBookings.filter(booking =>
            booking.phone.includes(currentSearchInstallation.replace(/\D/g, ''))
        );
    }
    installationTable.innerHTML = '';
    if (filteredBookings.length === 0) {
        installationTable.innerHTML = `<tr><td colspan="10" class="text-center">No installation bookings found.</td></tr>`;
        return;
    }
    filteredBookings.forEach(booking => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${new Date(booking.timestamp.toDate()).toLocaleDateString('en-GB')}</td>
            <td>${booking.name || 'N/A'}</td>
            <td>${booking.phone || 'N/A'}</td>
            <td>${booking.address || 'N/A'}</td>
            <td><input type="number" class="num-cameras-input" data-id="${booking.id}" value="${booking.numCameras || ''}" min="1" placeholder="Enter Number of Cameras"></td>
            <td><input type="number" class="price-input" data-id="${booking.id}" value="${booking.price || ''}" min="0" placeholder="Enter Price"></td>
            <td><input type="text" class="serial-number-input" data-id="${booking.id}" value="${booking.serialNumber || ''}" placeholder="Enter Serial Number"></td>
            <td><input type="text" class="passwords-input" data-id="${booking.id}" value="${booking.passwords || ''}" placeholder="Enter DVR/Camera Password"></td>
            <td>
                <select class="status-select" data-id="${booking.id}">
                    <option value="Pending" ${booking.status === 'Pending' ? 'selected' : ''}>Pending</option>
                    <option value="Completed" ${booking.status === 'Completed' ? 'selected' : ''}>Completed</option>
                    <option value="Cancelled" ${booking.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                </select>
            </td>
            <td><button class="save-btn" data-id="${booking.id}">Save</button></td>
        `;
        installationTable.appendChild(row);
    });

    // Attach event listeners to save buttons
    document.querySelectorAll('.save-btn').forEach(button => {
        button.addEventListener('click', async () => {
            const bookingId = button.getAttribute('data-id');
            await updateInstallationBooking(bookingId);
        });
    });
}

// Switch to Pending Tab
function switchToPendingTab() {
    if (currentMainTab === 'service') {
        currentSubTabService = 'pending';
        localStorage.setItem('currentSubTabService', 'pending');
        subTabsService.forEach(tab => {
            tab.classList.toggle('active', tab.getAttribute('data-tab') === 'pending');
        });
        loadServiceBookings();
    } else {
        currentSubTabInstallation = 'pending';
        localStorage.setItem('currentSubTabInstallation', 'pending');
        subTabsInstallation.forEach(tab => {
            tab.classList.toggle('active', tab.getAttribute('data-tab') === 'pending');
        });
        loadInstallationBookings();
    }
    console.log(`Switched to Pending tab for ${currentMainTab}`);
}

// Update Service Booking
async function updateServiceBooking(bookingId) {
    console.log('Updating service booking:', bookingId);
    const row = serviceTable.querySelector(`tr .save-btn[data-id="${bookingId}"]`).closest('tr');
    const solution = row.querySelector('.solution-textarea').value.trim();
    const amount = parseFloat(row.querySelector('.amount-input').value) || 0;
    const status = row.querySelector('.status-select').value;
    const booking = serviceBookings.find(b => b.id === bookingId);

    if (!booking) {
        console.error('Booking not found:', bookingId);
        errorMessage.textContent = 'Booking not found.';
        errorMessage.classList.add('active');
        return;
    }

    try {
        const bookingRef = doc(db, 'bookings', bookingId);
        let updateData = { solution, amount, status };
        let shouldSendEmail = false;

        if (status === 'Completed') {
            if (!booking.invoiceNumber) {
                const invoiceNumber = await generateInvoiceNumber();
                updateData.invoiceNumber = invoiceNumber;
                shouldSendEmail = true;
            } else {
                shouldSendEmail = await createCustomConfirmModal('This booking is already marked as Completed and has an invoice. Would you like to resend the invoice email?');
            }
        }

        await updateDoc(bookingRef, updateData);
        console.log('Service booking updated:', bookingId, updateData);

        Object.assign(booking, updateData);

        if (shouldSendEmail) {
            await sendServiceInvoiceEmail({ ...booking, ...updateData });
        }

        successMessage.textContent = 'Service booking updated successfully!';
        successMessage.classList.add('active');
        errorMessage.classList.remove('active');

        switchToPendingTab();

        setTimeout(() => {
            successMessage.classList.remove('active');
        }, 3000);
    } catch (error) {
        console.error('Update service booking error:', error);
        errorMessage.textContent = `Error updating service booking: ${error.message}`;
        errorMessage.classList.add('active');
        successMessage.classList.remove('active');
    }
}

// Update Installation Booking
async function updateInstallationBooking(bookingId) {
    console.log('Updating installation booking:', bookingId);
    const row = installationTable.querySelector(`tr .save-btn[data-id="${bookingId}"]`).closest('tr');
    const numCameras = parseInt(row.querySelector('.num-cameras-input').value) || 0;
    const price = parseFloat(row.querySelector('.price-input').value) || 0;
    const serialNumber = row.querySelector('.serial-number-input').value.trim();
    const passwords = row.querySelector('.passwords-input').value.trim();
    const status = row.querySelector('.status-select').value;
    const booking = installationBookings.find(b => b.id === bookingId);

    if (!booking) {
        console.error('Booking not found:', bookingId);
        errorMessage.textContent = 'Booking not found.';
        errorMessage.classList.add('active');
        return;
    }

    try {
        const bookingRef = doc(db, 'installations', bookingId);
        let updateData = { numCameras, price, serialNumber, passwords, status };
        let shouldSendEmail = false;

        if (status === 'Completed') {
            if (!booking.invoiceNumber) {
                const invoiceNumber = await generateInvoiceNumber();
                updateData.invoiceNumber = invoiceNumber;
                shouldSendEmail = true;
            } else {
                shouldSendEmail = await createCustomConfirmModal('This booking is already marked as Completed and has an invoice. Would you like to resend the invoice email?');
            }
        }

        await updateDoc(bookingRef, updateData);
        console.log('Installation booking updated:', bookingId, updateData);

        Object.assign(booking, updateData);

        if (shouldSendEmail) {
            await sendInstallationInvoiceEmail({ ...booking, ...updateData });
        }

        successMessage.textContent = 'Installation booking updated successfully!';
        successMessage.classList.add('active');
        errorMessage.classList.remove('active');

        switchToPendingTab();

        setTimeout(() => {
            successMessage.classList.remove('active');
        }, 3000);
    } catch (error) {
        console.error('Update installation booking error:', error.code, error.message);
        if (error.code === 'permission-denied') {
            errorMessage.textContent = 'Error: Insufficient permissions to update booking. Ensure you are signed in as an admin and the document only contains allowed fields. Check Firestore rules and document structure.';
        } else {
            errorMessage.textContent = `Error updating installation booking: ${error.message}`;
        }
        errorMessage.classList.add('active');
        successMessage.classList.remove('active');
    }
}

// Main Tab Switching
mainTabs.forEach(tab => {
    tab.addEventListener('click', () => {
        mainTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentMainTab = tab.getAttribute('data-main-tab');
        localStorage.setItem('currentMainTab', currentMainTab);
        document.getElementById('service-content').classList.toggle('hidden', currentMainTab !== 'service');
        document.getElementById('installation-content').classList.toggle('hidden', currentMainTab !== 'installation');
        console.log('Switched to main tab:', currentMainTab);
        if (currentMainTab === 'service') {
            loadServiceBookings();
        } else {
            loadInstallationBookings();
        }
    });
});

// Sub Tab Switching (Service)
subTabsService.forEach(tab => {
    tab.addEventListener('click', () => {
        subTabsService.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentSubTabService = tab.getAttribute('data-tab');
        localStorage.setItem('currentSubTabService', currentSubTabService);
        console.log('Switched to service sub-tab:', currentSubTabService);
        loadServiceBookings();
    });
});

// Sub Tab Switching (Installation)
subTabsInstallation.forEach(tab => {
    tab.addEventListener('click', () => {
        subTabsInstallation.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentSubTabInstallation = tab.getAttribute('data-tab');
        localStorage.setItem('currentSubTabInstallation', currentSubTabInstallation);
        console.log('Switched to installation sub-tab:', currentSubTabInstallation);
        loadInstallationBookings();
    });
});

// Search Service Bookings
searchBtnService.addEventListener('click', () => {
    currentSearchService = phoneSearchService.value.trim();
    console.log('Searching service bookings with phone:', currentSearchService);
    renderServiceBookings();
});

// Search Installation Bookings
searchBtnInstallation.addEventListener('click', () => {
    currentSearchInstallation = phoneSearchInstallation.value.trim();
    console.log('Searching installation bookings with phone:', currentSearchInstallation);
    renderInstallationBookings();
});

// Debounced search on input
phoneSearchService.addEventListener('input', debounce(() => {
    currentSearchService = phoneSearchService.value.trim();
    console.log('Debounced search service bookings with phone:', currentSearchService);
    renderServiceBookings();
}, 500));

phoneSearchInstallation.addEventListener('input', debounce(() => {
    currentSearchInstallation = phoneSearchInstallation.value.trim();
    console.log('Debounced search installation bookings with phone:', currentSearchInstallation);
    renderInstallationBookings();
}, 500));
});
</script>
</script>
</body>
</html>